<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script>
      // Your Firebase configuration

    const firebaseConfig = {
    apiKey: "AIzaSyBdJqp2UtfqDIYAT4LyW_X2R-Rz4y_DS8s",
    authDomain: "carttle--111104.firebaseapp.com",
    projectId: "carttle--111104",
    storageBucket: "carttle--111104.appspot.com",
    messagingSenderId: "676788237475",
    appId: "1:676788237475:web:f780d49d80d9c9ddcf7b16",
    };


      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      function sendOtp() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
          'size': 'invisible'
        });

        firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
          .then(function (confirmationResult) {
            window.confirmationResult = confirmationResult;
            alert("OTP sent!");
          }).catch(function (error) {
            console.error("Error during OTP send:", error);
            alert("Failed to send OTP. Check the console for errors.");
          });
      }

      function verifyOtp() {
        const code = document.getElementById('otpCode').value;

        confirmationResult.confirm(code)
          .then(function (result) {
            var user = result.user;
            console.log("User signed in successfully:", user);
            fetch('/verify-token', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ idToken: user.stsTokenManager.accessToken })
            })
            .then(response => response.json())
            .then(data => console.log(data));
          }).catch(function (error) {
            console.error("Error during OTP verification:", error);
            alert("Invalid OTP. Check the console for errors.");
          });
      }
    </script>
</head>
<body>
    <h1>OTP Verification</h1>
    <input type="text" id="phoneNumber" placeholder="Phone number">
    <button onclick="sendOtp()">Send OTP</button>
    <div id="recaptcha-container"></div>
    <input type="text" id="otpCode" placeholder="Enter OTP">
    <button onclick="verifyOtp()">Verify OTP</button>
</body>
</html>
